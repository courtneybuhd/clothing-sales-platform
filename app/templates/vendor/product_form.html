{% extends "base.html" %}

{% block title %}{% if product %}Edit Product{% else %}Create Product{% endif %}{% endblock %}

{% block content %}
{# 
  IMAGE HANDLING APPROACH:
  Store relative paths in database (e.g., "images/jacket1.png")
  Use url_for('static', filename=product.image_url) to generate full URLs
  This approach is more portable and follows Flask best practices.
#}
<div class="container">
    <div class="card">
        <div class="card-header">
            <h2>{% if product %}Edit Product{% else %}Create Product{% endif %}</h2>
        </div>
        <div class="card-body">
            <form method="POST">
                <div class="form-group">
                    <label for="name" class="form-label">Product Name *</label>
                    <input type="text" class="form-control" id="name" name="name" value="{% if product %}{{ product.name }}{% endif %}" required>
                </div>

                <div class="form-group">
                    <label for="description" class="form-label">Description</label>
                    <textarea class="form-control" id="description" name="description" rows="4">{% if product %}{{ product.description }}{% endif %}</textarea>
                </div>

                <div class="form-group">
                    <label for="category" class="form-label">Category *</label>
                    <input type="text" class="form-control" id="category" name="category" value="{% if product %}{{ product.category }}{% endif %}" required>
                    <small class="form-text">Examples: Hoodie, Shirt, Pants, Jacket, Sneakers</small>
                </div>

                <div class="form-group">
                    <label for="base_price" class="form-label">Base Price ($) *</label>
                    <input type="number" class="form-control" id="base_price" name="base_price" step="0.01" min="0" value="{% if product %}{{ product.base_price }}{% endif %}" required>
                </div>

                <div class="form-group">
                    <label for="image_url" class="form-label">Image Path</label>
                    <input type="text" class="form-control" id="image_url" name="image_url" value="{% if product and product.image_url %}{{ product.image_url }}{% endif %}" placeholder="images/jacket1.png">
                    <small class="form-text">Enter relative path to image in static folder (e.g., "images/jacket1.png")</small>
                    
                    {% if product and product.image_url %}
                        <div style="margin-top: 15px; padding: 10px; background-color: #f8f9fa; border-radius: 4px;">
                            <p style="margin-bottom: 10px;"><strong>Current Image Preview:</strong></p>
                            <img src="{{ url_for('static', filename=product.image_url) }}" 
                                 alt="{{ product.name }}" 
                                 style="max-width: 300px; max-height: 300px; border: 1px solid #ddd; border-radius: 4px; display: block;"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div style="display: none; padding: 20px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; color: #856404;">
                                <strong>Image not found:</strong> {{ product.image_url }}
                            </div>
                        </div>
                    {% endif %}
                </div>

                {% if product %}
                <div class="form-group">
                    <label for="available" class="form-label">Availability</label>
                    <div>
                        <input type="checkbox" id="available" name="available" {% if product.available %}checked{% endif %}>
                        <label for="available">Product is available for sale</label>
                    </div>
                </div>
                {% endif %}

                {% if not product %}
                <hr style="margin: 30px 0;">
                <h3>Initial SKU Variant</h3>
                <p style="color: #6c757d;">Add the first size and color variant for this product.</p>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="size" class="form-label">Size *</label>
                        <input type="text" class="form-control" id="size" name="size" placeholder="S, M, L, XL" required>
                    </div>

                    <div class="form-group">
                        <label for="color" class="form-label">Color *</label>
                        <input type="text" class="form-control" id="color" name="color" placeholder="Black, White, Blue" required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="inventory" class="form-label">Inventory (Stock Quantity) *</label>
                        <input type="number" class="form-control" id="inventory" name="inventory" min="0" value="0" required>
                    </div>

                    <div class="form-group">
                        <label for="price_adjustment" class="form-label">Price Adjustment ($)</label>
                        <input type="number" class="form-control" id="price_adjustment" name="price_adjustment" step="0.01" value="0" placeholder="0.00">
                        <small class="form-text">Additional charge for this variant (optional)</small>
                    </div>
                </div>
                {% endif %}

                <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-primary">
                        {% if product %}Save Changes{% else %}Create Product{% endif %}
                    </button>
                    <a href="{{ url_for('vendor.dashboard') }}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
